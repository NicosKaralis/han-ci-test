env:
  global:
    - name: BITBUCKET_USER_NAME
    - secure: duCf4j0NVm/JdYCOa5PsX7MUBncl326iiMXPG7eOSSSgzYDxsV+7f8O43Ui6KeDLJT29dEU+fTe5ege49skGjWrDiXLbYShxxMd1DJx/ulPxynvrm90O07UHltPlMYl9HztwGqkB0p6WlN4yHiUf2tAYS6u5a5UWYbbrQvjIa3LlHlYfnqoC1fbneBn44cL/j79ukSQrGoyNSsvqbBMOkVsrIixTaHeWNumP75Kv5z9cWRUOtuY507bQA9Aj8sYvrKRAjXTB+ey4tyb1aD2u6JYStFsKC4133W91kttc+D3YHfpWdEwe14R7/XPL2n+euzRQhVr4miR+F/1pXSoAvqPlPWi9KhXlhlHas7JRL40SeGmOuERX+lyFz4kG72rE/eRTJLxEpHB16BdW30fENpUZ0zCQuiSORdmigD4glowxtf6vX7KcKlHvtw3X2axjTFzPKAbL60v1t4HgE9eL2ZW2pTYnik/GT3zMA3xLYSxOUW4x0dAlOtskLEf1fFfMVZkg+mJflp2LfYgwIh/Ddn1HQZYbYoyx4kgG6LXRvKU1ZQFWSbjNYZUm/g5pReBp3+cR1ZOZiIkk2YaUpcrtlFazOj2ieXD21OBo0m5GaEyzrPaU7ZyiOBzMt9olTILmjxTfnIlUJQJr1yo2Jzf3hKEFpRTmeJYFtGqs+bJQKrA= # BITBUCKET_USER_NAME
    - name: BITBUCKET_USER_PASSWORD
    - secure: jwnuTcfHyjjJkEtRDBAVua68bt1Tygtw6qy4Qkf1hB5lq04ehvBVEqH+oAjdjl+wNqmyeGkt8E7wdAs3K+3eURbHlxBO/1hQyf2VZZz0JwTJyl/dt3eBuinHq5ZoUaKO69+rvp2AB8MIM8C0yWAW7xsq6OZqSX0SBUaLiQ8iMfueJjARFXHj04i8HMtjneHQopwL4jPpfYj4Zk7oNVSzkhpP3TZN8BkJCx2Ta4vPZfddPj5iRP4gNKuwnvyQK7ZbudY976UDTwc/o9vM9gSOyl/paY+tlvU9n0cWqu+6gg6h4cP9/Gtm5nHtHciSF72E2srlXJty2yY49JmEQfY4tlOToyZtXlWR36LHsk3ztH51Bun8UG6oo8UHhEIqWpPcU2UyAz5nhfuar33kMLINdbrISYFHtf2K6n2gadViCtCWaffXBzLoDKtmZfcd1zghMBxkpvwWuNAwv3CdFlXPQ3SSlnNCj7Yyzwd8w5PknJfAODthpIwxjhNKS2DgC7iYMMeixu9zj3oHhcBA50DpFB5xa5LajKahAUDy3HfniD428zVos45f1GYXNCCFkjbMMHdUMpgb8/JiSyZsW7F6x89AZOqxVJ72WcJzBWH5JIvtji4/J1ypN4e8psLtcYffBj2UN+yMHr/JbfnsjTizEj/OpAlcgKz2zwbeGlXBDJU= # BITBUCKET_USER_PASSWORD
    - name: FASTLANE_PASSWORD
    - secure: CglZmVTRiZsd6Ugpp777jd6dG+BDsDCbWIVth7852XKxNscu7UZmKfvrQ0ZcLN/jwpAnACwGRx93fcA2DgffAaZO+t65/YY8Xma4ybITrG+xwG5BhQVuA7GnH1oD8xbDoMiovS4muh35reKUqioipoey5lTkq4ZpnnX1MulFgA48Sum8lKOlh3U4al5p084Hs19TzoZWm64tIel6Ap8RXvfPFXkyNl2JNM+y+gyQoCQx16h4JRaNmX3SLrqFIQTxFxaheZxMvIo0EIu6vbdYV2MGFIXGjNmGYik16i8FefG0hdyxiclXdeQkxMOfwd/H34C/Z6A2XVk6PDeJE07AYSHEpO3C0btb1ggHlO3Izz2UCY2E/vKDqPGWqwRaR/X1LX/T+137as3MSC+1uB7aZo9DzYRWw2bk6xg6Xuu1lrq4+YgjCHy2Z/Jhj5b8Y913e9nD0grELkIyeOQheFXapPuBG7kzC7Q9K6DoUW7kVhKMXVWUlGAWywUIMaJMOe9Dj+vaVOFgCX9W7LAtQS1Adjzhe+0ifVFiKh57HoSICfg2yagwfljqMcax2VmP9HtkWNpnP3sX9oTHg5VoCuy168Qn1M1hdSbUxKOp1q5eUJ3oLiDoN0Hqlkk+iTAsEeGupHryJ0Fm2o8vJLDLIy4MDQQ3pClAh++Bq47T+wmoHuk= # FASTLANE_PASSWORD
    - name: BITBUCKET_BUILD_AUTH
    - secure: Kl+aaFeUSDMtRL3bU66P3ol/bKwhwOVZ6Q8YYcz6OUcqtsw+O27jis7XK3n8bVTmKbxwPEU5HZKESMgi3I4YzAlv8//S7wATJN1whK9HL9A0+XSyWQjsNqz3jyjGesXFQJ+EcSpMIAMG1MpyDrr91M5g0WMnloPO3+7PcCK78lkCfkh7jtEPsKHQCkpWWLe+a913W+In/EcujzkR2T/tLE4HKzEMn3XO++MSrf2ey7vYUJFF1WAWBKAf107t1KGB2DspxfRsMWT2oRRa1dkxFF/VDdD0tf34AYijH4c1Oc0WxH8faZpPsw+4BtgbcOQws4g7+GAqdQUutW5cfQVyi6N7I0ZfUYai0PZvZIZ+hsfIUc1bPOGya7U6k0nkt1agoSbWU8XGhnvrvYt/nuQNSfboJLMC2vTBiwMegt09kePACSOMFsLe9RJoDCbWUW4GSU58ThXokC96Hl6KoVI2XZqdpHwE+XOZDe3byscittEg2dJStDOHQZwwYAfwiic9J2YM3dr2ZxuOlLzMNPcllZD6SJv+9RU+eJ/PpuJ8R24mfjnljFTW9wP4E1iK9lnFfKlDUMN4fWMx8xBmggOSPGFwWv/aU8s0r30YpwR2T298UftwUfIHQNzkIMQtmoPbwuLIGR9tFeL/h+N5qBzdjqAcQsJUAdHPQFjKXR29boQ= # BITBUCKET_BUILD_AUTH
    - name: MATCH_PASSWORD
    -secure: Ts/HcS0FuNEyOCy2f1ip/CspbGiK/yXpdIIf9d0EctYcQIfBl4Ww00Ghx7L6ZrjpqdIInE1D6suTHXCWTB71wEBF+FCdqY+pZJHCNnsbj69MzFXGq86KhZkJyf1eFRAaRfY4K0PrhwNvd0UapsMIpTgSrdOtVahgwDIFDpcCKV0nrTd1Eg1puUB+MQI5kQRztGMuTPTWtrfhTvF/QxxJ9XRc2vdJHVveBx7b+1IqpTHoLkc7ixuzT5WyINlcCpj6YjnRbKeZZSATr0u4VLQA6y5LpAw2CMWpCXGY86nZmidYi7at1x8fR6EdD5c1nvZ0I2a8k+mhrTwYF1nc5gFYiyL8KB9xpk6K7sRIocSGu9m0DRuazFK5M5ubJvrlinW3KRKdkr+DrjXRTLTXOyUP+xqgY3j1aVuzMX9L7vatorOXhKi/xza5Axbxs61E9AFYV2nTUiXAa9TRvRQU9Flis3HErJwCnkehdP72SRiwCARirfieAUs0HSklo+JZDYTfm551UYnOJGMPzsKRmuv6nxw04xGywR036NgyADbUGY267YvxYMfjCWYewHJFRgkQ73HtRZdNvij+Boab8UTuAUC6ZxZOmsB3B8mlOQyLfZN0wO2akjQE8n+OPFYG2WeiDpQkggSKqH/T1DOr+CPN0iKx/DSBRdiGxCB3BpmkK5w= # MATCH_PASSWORD
git:
  submodules: false
before_install:
  # - |-
  #   echo -e "machine bitbucket.org
  #     login $BITBUCKET_USER_NAME
  #     password $BITBUCKET_USER_PASSWORD" > ~/.netrc
  # - git submodule update --init --recursive
  # - mv han-ios-app/* .
  # - echo -e "FASTLANE_PASSWORD=$FASTLANE_PASSWORD" > ~/.env
  # - gem install bundler
# cache:
#   bundler: true
#   cocoapods: true
#   directories:
#     - "$HOME/.rvm/"
#     # - "$HOME/.cocoapods/"
install: true
# script:
#   - bundle install --deployment
#   - bundle exec pod repo update
#   - bundle exec fastlane development

language: generic
os: linux

matrix:
  include:
    - language: android
      env:
        - BUNDLE_GEMFILE: han-ios-android/Gemfile
      cache:
        directories:
          - "$HOME/han-ios-android/vendor/bundle"
      install:
        - rvm install 2.5.3
        - rvm use 2.5.3
        - gem install bundler
        - bundle install --deployment --binstubs --gemfile=$BUNDLE_GEMFILE
        - echo "Install Android depentencies"
        - han-ios-android/bin/fastlane -v
      script:
        - echo "Build Android app with fastlane"
    - language: objective-c
      os: osx
      osx_image: xcode10.2
      env:
        - BUNDLE_GEMFILE: han-ios-app/Gemfile
      cache:
        bundler: true
        cocoapods: true
        directories:
          - "$HOME/.rvm/"
          - "$HOME/han-ios-app/vendor/bundle"
      before_install:
        - |-
          echo -e "machine bitbucket.org
            login $BITBUCKET_USER_NAME
            password $BITBUCKET_USER_PASSWORD" > ~/.netrc
        - ssh-keyscan -H bitbucket.org >> ~/.ssh/known_hosts
        - git submodule update --init --recursive
        - echo -e "FASTLANE_APPLE_APPLICATION_SPECIFIC_PASSWORD=$FASTLANE_PASSWORD" > $TRAVIS_BUILD_DIR/han-ios-app/fastlane/.env
        - |-
          echo 'FASTLANE_SESSION=---\n- !ruby/object:HTTP::Cookie\n  name: myacinfo\n  value: DAWTKNV2411f616999f899050f0a897aab521d03d83b29237ed7abbd1829707d5c98394751e768468ea8233713c7cab3eb58ca78961c48081628cb0ef848606c6f3680f0da18e2f3bd1d3e9aa27ff8c9bcc32b3bb2153cf989b8737eeaf3f60d5394b5a8dc50ed386129174c1cf191048cfb771937a965e6da7d2c5776ec7e24a9f738d1e45f966b34808bd804903c6bd398774a6bb1b0ef009cc5009e4877d304049be78377181f1b674acdbaaae01c37cd1f0aa4dc44e43803b6e435e12abc5d9032645847d341fc69da04eaf56af2657a2d39f772c7400d3cf45fdde5e7489590fe54b9e4779910480153664cfcf5fc587578231822bcdf50fa62e78376cbddb41d9d61616336323465383763393565656339613838366134343337373462313664393866393032393336MVRYV2\n  domain: apple.com\n  for_domain: true\n  path: "/"\n  secure: true\n  httponly: true\n  expires: \n  max_age: \n  created_at: 2019-04-16 12:43:21.998213000 -03:00\n  accessed_at: 2019-04-16 13:08:02.325435000 -03:00\n- !ruby/object:HTTP::Cookie\n  name: dqsid\n  value: eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJqdGkiOiJXMmQ3MzhoT2VtOHJQazMtakdfTlZRIn0.5NDl2aaXL9zaZ1fTNMWpKt2uxzOrQaR0Y1V91ixPRjQ\n  domain: olympus.itunes.apple.com\n  for_domain: false\n  path: "/"\n  secure: true\n  httponly: true\n  expires: \n  max_age: 1800\n  created_at: &1 2019-04-16 13:08:03.478893000 -03:00\n  accessed_at: *1\n' >> $TRAVIS_BUILD_DIR/han-ios-app/fastlane/.env
        - rvm install 2.5.3
        - ./build-start.sh $BITBUCKET_BUILD_AUTH $(cd han-ios-app ; git rev-parse HEAD) $TRAVIS_JOB_WEB_URL
      install:
        - rvm use 2.5.3
        - gem install bundler
        - bundle install --deployment --binstubs --gemfile=$BUNDLE_GEMFILE --path vendor/bundle
        - echo "Install iOS depentencies"
        - han-ios-app/bin/fastlane -v
        - cd han-ios-app
        - BUNDLE_GEMFILE=./Gemfile ./bin/fastlane development --verbose
      script:
        - echo "Build iOS app with fastlane"
      after_script:
        - $TRAVIS_BUILD_DIR/build-end.sh $BITBUCKET_BUILD_AUTH $TRAVIS_TEST_RESULT $(cd han-ios-app ; git rev-parse HEAD) $TRAVIS_JOB_WEB_URL
